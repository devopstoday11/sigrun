# Cosign keyless mode flow

Current cosign keyless documentation [here](https://github.com/sigstore/cosign/blob/main/KEYLESS.md) only covers usage.
Here we cover the current cosign keyless flow as inferred from the source code.

Sign -
1. Browser is opened prompting user to login to their email.
2. After logging in, the email provider will provide cosign with an OICID token.
3. This token is signed by private key.
4. A request is made to the fulcio server with the token, signature and public key.
5. Fulcio server is a root ca, it first creates a certificate with the received data and signs it.
6. Fulcio generated certificate is received by cosign.
7. Payload is now signed by the private key.
8. The certificate which was obtained from fulcio is uploaded to rekor.
8. Signature file is uploaded which contains the payload signature, fulcio certificate and meta data.
9. Public and private keys are deleted.

Verify -
1. Signature file is retrieved from the container registry.
2. The file contains payload signature, fulcio certificate and other meta data.
3. The fulcio certificate is verified against the fulcio root ca certificate, proving this certificate was generated by fulcio.
4. The signature is verified by the public key in the certificate, proving it was signed by the private key corresponding to the public key
in the fulcio certificate.
5. The rekor server is queried to get the tlog entry corresponding to the fulcio certificate.
6. The tlog entry contains the time at which the certificate was added to rekor, cosign verifies that the certificate was
added to rekor while it was still valid.




